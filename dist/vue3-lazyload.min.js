/*!
 * Vue3-Lazyload.js v0.2.3-beta
 * A Vue3.x image lazyload plugin
 * (c) 2021 MuRong <admin@imuboy.cn>
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).VueLazyload=e()}(this,function(){"use strict";var i,t;(t=i=i||{}).LOADING="loading",t.LOADED="loaded",t.ERROR="error";var e="undefined"!=typeof window&&null!==window,s=function(){if(e&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)return"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return 0<this.intersectionRatio}}),!0;return!1}(),a=Object.prototype.propertyIsEnumerable,u=Object.getOwnPropertySymbols;function f(t){return"function"==typeof t||"[object Object]"===toString.call(t)}function p(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];var r,n,i=0;for(t=(t=("object"==typeof(r=t)?null===r:"function"!=typeof r)?e[i++]:t)||{};i<e.length;i++)if(f(e[i])){for(var s=0,c=Object.keys(e[i]);s<c.length;s++){var l=c[s];"__proto__"!==(n=l)&&"constructor"!==n&&"prototype"!==n&&(f(t[l])&&f(e[i][l])?p(t[l],e[i][l]):t[l]=e[i][l])}!function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];if(!f(t))throw new TypeError("expected the first argument to be an object");if(0===e.length||"function"!=typeof Symbol||"function"!=typeof u)return;for(var r=0,n=e;r<n.length;r++)for(var i=n[r],s=0,c=u(i);s<c.length;s++){var l=c[s];a.call(i,l)&&(t[l]=i[l])}}(t,e[i])}return t}var o={rootMargin:"0px",threshold:0},c="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",r=(n.prototype.config=function(t){p(this.options,t=void 0===t?{}:t)},n.prototype.mount=function(t,e){this._image=t;var o=this._valueFormatter(e.value),r=o.src,n=o.loading,e=o.error,o=o.lifecycle;this._lifecycle(i.LOADING,o,t),this._image.setAttribute("src",n||c),s||(this.loadImages(t,r,e,o),this._log(function(){throw new Error("Not support IntersectionObserver!")})),this._initIntersectionObserver(t,r,e,o)},n.prototype.update=function(t,e){this._observer.unobserve(t);var o=this._valueFormatter(e.value),r=o.src,e=o.error,o=o.lifecycle;this._initIntersectionObserver(t,r,e,o)},n.prototype.unmount=function(t){this._observer.unobserve(t)},n.prototype.loadImages=function(t,e,o,r){this._setImageSrc(t,e,o,r)},n.prototype._setImageSrc=function(t,e,o,r){var n=this;"img"===t.tagName.toLowerCase()?(e&&t.getAttribute("src")!==e&&t.setAttribute("src",e),this._listenImageStatus(t,function(){n._lifecycle(i.LOADED,r,t)},function(){t.onload=null,n._lifecycle(i.ERROR,r,t),n._observer.disconnect(),o&&t.setAttribute("src",o),n._log(function(){throw new Error("Image failed to load!")})})):t.style.backgroundImage="url('"+e+"')"},n.prototype._initIntersectionObserver=function(e,o,r,n){var i=this,t=this.options.observerOptions;this._observer=new IntersectionObserver(function(t){Array.prototype.forEach.call(t,function(t){t.isIntersecting&&(i._observer.unobserve(t.target),i._setImageSrc(e,o,r,n))})},t),this._observer.observe(this._image)},n.prototype._listenImageStatus=function(t,e,o){t.onload=e,t.onerror=o},n.prototype._valueFormatter=function(t){var e=t,o=this.options.loading,r=this.options.error,n=this.options.lifecycle;return f(t)&&(e=t.src,o=t.loading||this.options.loading,r=t.error||this.options.error,n=t.lifecycle||this.options.lifecycle),{src:e,loading:o,error:r,lifecycle:n}},n.prototype._log=function(t){this.options.log&&t()},n.prototype._lifecycle=function(t,e,o){switch(t){case i.LOADING:this._image.setAttribute("lazy",i.LOADING),null!=e&&e.loading&&e.loading(o);break;case i.LOADED:this._image.setAttribute("lazy",i.LOADED),null!=e&&e.loaded&&e.loaded(o);break;case i.ERROR:this._image.setAttribute("lazy",i.ERROR),null!=e&&e.error&&e.error(o)}},n);function n(t){this.options={loading:c,error:"",observerOptions:o,log:!0,lifecycle:{}},this.config(t)}return{install:function(t,e){e=new r(e);t.config.globalProperties.$Lazyload=e,t.provide("Lazyload",e),t.directive("lazy",{mounted:e.mount.bind(e),updated:e.update.bind(e),unmounted:e.unmount.bind(e)})}}});
