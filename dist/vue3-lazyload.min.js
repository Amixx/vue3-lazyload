/*!
 * Vue3-Lazyload.js v0.1.1
 * A Vue3.x image lazyload plugin
 * (c) 2020 MuRong <admin@imuboy.cn>
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).VueLazyload=e()}(this,function(){"use strict";var t="undefined"!=typeof window&&null!==window,r=function(){if(t&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)return"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return 0<this.intersectionRatio}}),!0;return!1}(),a=Object.prototype.propertyIsEnumerable,p=Object.getOwnPropertySymbols;function f(t){return"function"==typeof t||"[object Object]"===toString.call(t)}function l(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];var n,r,i=0;for(("object"==typeof(n=t)?null===n:"function"!=typeof n)&&(t=e[i++]),t=t||{};i<e.length;i++)if(f(e[i])){for(var s=0,c=Object.keys(e[i]);s<c.length;s++){var u=c[s];"__proto__"!==(r=u)&&"constructor"!==r&&"prototype"!==r&&(f(t[u])&&f(e[i][u])?l(t[u],e[i][u]):t[u]=e[i][u])}!function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];if(!f(t))throw new TypeError("expected the first argument to be an object");if(0===e.length||"function"!=typeof Symbol||"function"!=typeof p)return;for(var n=0,r=e;n<r.length;n++)for(var i=r[n],s=0,c=p(i);s<c.length;s++){var u=c[s];a.call(i,u)&&(t[u]=i[u])}}(t,e[i])}return t}var e={rootMargin:"0px",threshold:0},i="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",o=(n.prototype.config=function(t){void 0===t&&(t={}),l(this.options,t)},n.prototype.mount=function(t,e){this._image=t;var o=this._valueFormatter(e.value),n=o.src,e=o.loading,o=o.error;this._image.setAttribute("src",e||i),r||(this.loadImages(t,n,o),this.options.silent&&this._log(function(){throw new Error("Not support IntersectionObserver!")})),this._initIntersectionObserver(t,n,o)},n.prototype.update=function(t){this._observer.unobserve(t),this._observer.observe(t)},n.prototype.unmount=function(t){this._observer.unobserve(t)},n.prototype.loadImages=function(t,e,o){this._setImageSrc(t,e,o)},n.prototype._setImageSrc=function(t,e,o){var n=this,r=t.getAttribute("srcset");"img"===t.tagName.toLowerCase()?(e&&t.setAttribute("src",e),r&&t.setAttribute("srcset",r),this._listenImageStatus(t,function(){n._log(function(){console.log("Image loaded successfully!")})},function(){t.setAttribute("src",o||""),n._log(function(){throw new Error("Image failed to load!")})})):t.style.backgroundImage="url('"+e+"')"},n.prototype._initIntersectionObserver=function(e,o,n){var r=this,t=this.options.observerOptions;this._observer=new IntersectionObserver(function(t){Array.prototype.forEach.call(t,function(t){t.isIntersecting&&(r._observer.unobserve(t.target),r._setImageSrc(e,o,n))})},t),this._observer.observe(this._image)},n.prototype._listenImageStatus=function(t,e,o){t.onload=function(){e()},t.onerror=function(){o()}},n.prototype._valueFormatter=function(t){var e=t,o=this.options.loading,n=this.options.error;return f(t)&&(e=t.src,o=t.loading||this.options.loading,n=t.error||this.options.error),{src:e,loading:o,error:n}},n.prototype._log=function(t){this.options.silent||t()},n);function n(t){this.options={loading:i,error:"",observerOptions:e,silent:!0},this.config(t)}return{install:function(t,e){e=new o(e);t.config.globalProperties.$Lazyload=e,t.provide("Lazyload",e),t.directive("lazy",{mounted:e.mount.bind(e),updated:e.update.bind(e),unmounted:e.unmount.bind(e)})}}});
