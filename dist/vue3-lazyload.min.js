/*!
 * Vue3-Lazyload.js v0.1.1
 * A Vue3.x image lazyload plugin
 * (c) 2020 MuRong <admin@imuboy.cn>
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).VueLazyload=e()}(this,function(){"use strict";var t="undefined"!=typeof window&&null!==window,o=function(){if(t&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)return"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return 0<this.intersectionRatio}}),!0;return!1}(),a=Object.prototype.propertyIsEnumerable,p=Object.getOwnPropertySymbols;function f(t){return"function"==typeof t||"[object Object]"===toString.call(t)}function l(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];var n,r,i=0;for(("object"==typeof(n=t)?null===n:"function"!=typeof n)&&(t=e[i++]),t=t||{};i<e.length;i++)if(f(e[i])){for(var s=0,u=Object.keys(e[i]);s<u.length;s++){var c=u[s];"__proto__"!==(r=c)&&"constructor"!==r&&"prototype"!==r&&(f(t[c])&&f(e[i][c])?l(t[c],e[i][c]):t[c]=e[i][c])}!function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];if(!f(t))throw new TypeError("expected the first argument to be an object");if(0===e.length||"function"!=typeof Symbol||"function"!=typeof p)return;for(var n=0,r=e;n<r.length;n++)for(var i=r[n],s=0,u=p(i);s<u.length;s++){var c=u[s];a.call(i,c)&&(t[c]=i[c])}}(t,e[i])}return t}var e={rootMargin:"0px",threshold:0},n="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",r=(i.prototype.config=function(t){void 0===t&&(t={}),l(this.options,t)},i.prototype.mount=function(t,e){if(this._image=t,this._image.setAttribute("src",this.options.loading||n),!o)throw this.loadImages(t,e.value),new Error("not support IntersectionObserver");this._initIntersectionObserver(t,e.value)},i.prototype.update=function(t){this._observer.unobserve(t),this._observer.observe(t)},i.prototype.unmount=function(t){this._observer.unobserve(t)},i.prototype.loadImages=function(t,e){this._setImageSrc(t,e)},i.prototype._setImageSrc=function(t,e){var o=this,n=t.getAttribute("srcset");"img"===t.tagName.toLowerCase()?(e&&t.setAttribute("src",e),n&&t.setAttribute("srcset",n),this._listenImageStatus(t,function(){console.log("success")},function(){console.error("error"),t.setAttribute("src",o.options.error||"123")})):t.style.backgroundImage="url('"+e+"')"},i.prototype._initIntersectionObserver=function(e,o){var n=this,t=this.options.observerOptions;this._observer=new IntersectionObserver(function(t){Array.prototype.forEach.call(t,function(t){t.isIntersecting&&(n._observer.unobserve(t.target),n._setImageSrc(e,o))})},t),this._observer.observe(this._image)},i.prototype._listenImageStatus=function(t,e,o){t.onload=function(){e()},t.onerror=function(){o()}},i);function i(t){this.options={loading:(null==t?void 0:t.loading)||n,observerOptions:(null==t?void 0:t.observerOptions)||e,error:(null==t?void 0:t.error)||""}}return{install:function(t,e){e=new r(e);t.config.globalProperties.$Lazyload=e,t.provide("Lazyload",e),t.directive("lazy",{mounted:e.mount.bind(e),updated:e.update.bind(e),unmounted:e.unmount.bind(e)})}}});
